<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<!-- Mirrored from www.quercus-lab.com/vb-opc-klijent/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Sep 2018 12:44:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head><link rel="stylesheet" type="text/css" href="../wp-content/cache/minify/000000/VYxBCsAgDAQ_pMQ-ycZ4qkYSRf19pbRCbzvDsA4IWQi0zouMewlVIQiXRLn9JHJarqo5IPqM8-RhI4vtLKEIreLTe6y0F6szVz-ej003.css" media="all" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>VB OPC klijent | Quercus Lab</title><link rel="profile" href="http://gmpg.org/xfn/11" /><link rel="pingback" href="../xmlrpc.php" /><script type="text/javascript" src="../wp-content/cache/minify/000000/M9BPTc4vStXPKtZPKcovyE3NK9XLKixNLarUMcCUAgA.js"></script><style type="text/css">#fancybox-close{right:-15px;top:-15px}div#fancybox-content{border-color:#FFF}div#fancybox-title{background-color:#FFF}div#fancybox-outer{background-color:#FFF}div#fancybox-title-inside{color:#333}</style><link rel='dns-prefetch' href='http://p.jwpcdn.com/' /><link rel='dns-prefetch' href='http://s.w.org/' /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.quercus-lab.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><script type="text/javascript" src="../wp-content/cache/minify/000000/M9bPKixNLarUMYYydHMz04sSS1L1cjPzdAz10xLzkiuT8it00_KLdMvzi1IKilKLi-HCUE16MD4A.js"></script><script type='text/javascript' src='../../p.jwpcdn.com/6/5/jwplayer5010.js?ver=4.9.8'></script><link rel='https://api.w.org/' href='../wp-json/index.html' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /><link rel='prev' title='OPC Data Access server' href='../opc-data-acces-server/index.html' /><link rel='next' title='Netduino &#8211; mikrokontroleri na objektni način' href='../netduino-mikrokontroleri-na-objektni-nacin/index.html' /><link rel="canonical" href="index.html" /><link rel='shortlink' href='../indexf45d.html?p=889' /><link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed16d4.json?url=http%3A%2F%2Fwww.quercus-lab.com%2Fvb-opc-klijent%2F" /><link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed0e8c?url=http%3A%2F%2Fwww.quercus-lab.com%2Fvb-opc-klijent%2F&amp;format=xml" /><script type="text/javascript">jQuery(function(){jQuery.fn.getTitle=function(){var arr=jQuery("a.fancybox");jQuery.each(arr,function(){var title=jQuery(this).children("img").attr("title");jQuery(this).attr('title',title);})}
var thumbnails=jQuery("a:has(img)").not(".nolightbox").filter(function(){return /\.(jpe?g|png|gif|bmp)$/i.test(jQuery(this).attr('href'))});thumbnails.addClass("fancybox").attr("rel","fancybox").getTitle();jQuery("a.fancybox").fancybox({'cyclic':false,'autoScale':true,'padding':10,'opacity':true,'speedIn':500,'speedOut':500,'changeSpeed':300,'overlayShow':true,'overlayOpacity':"0.3",'overlayColor':"#666666",'titleShow':true,'titlePosition':'inside','enableEscapeButton':true,'showCloseButton':true,'showNavArrows':true,'hideOnOverlayClick':true,'hideOnContentClick':false,'width':560,'height':340,'transitionIn':"fade",'transitionOut':"fade",'centerOnScroll':true});})</script><script type="text/javascript">jwplayer.defaults={"ph":2};</script><script type="text/javascript">if(typeof(jwp6AddLoadEvent)=='undefined'){function jwp6AddLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!='function'){window.onload=func;}else{window.onload=function(){if(oldonload){oldonload();}
func();}}}}</script><script type="text/javascript" src="../../s7.addthis.com/js/250/addthis_widget.js"></script></head><body class="post-template-default single single-post postid-889 single-format-standard"><div id="wrapper"><div id="container"><div id="header"><div class="innerwrap"><div id="siteinfo"><div id="site-title"> <a href="../index.html" title="Quercus Lab" rel="home">Quercus Lab</a></div><div id="site-description">Blog o softverskom razvoju, elektronici &#8230;</div></div><div id="topbanner"></div><div class="clearfix"></div></div></div><div id="navigation"><ul id="dropmenu"><li id="page_item"><a href="../index.html" title="Home">Home</a></li><li class="page_item page-item-42"><a href="../curriculum-vitae/index.html">Autor</a></li><li class="page_item page-item-523"><a href="../resculator/index.html">ResCulator</a></li><li class="page_item page-item-592"><a href="../o-otpornicima/index.html">O otpornicima</a></li></ul><div id="topsearch"><form method="get" id="searchform" action="http://www.quercus-lab.com/"> <input type="text" name="s" id="s" value="Search Here..." onfocus="if (this.value == 'Search Here...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search Here...';}" /> <input type="submit" id="searchsubmit" value="Search" /></form></div><div class="clearfix"></div></div><div id="main"><div id="breadcrumbs"><span>Trenutno ste tu&nbsp;: <a href="../index.html" title="Quercus Lab">Quercus Lab</a> &raquo; <a href="../category/automatizacija/index.html" title="View all posts in Automatizacija" >Automatizacija</a> &raquo; VB OPC klijent</span></div><div id="content"><div id="contentinner"><div id="post-entry"><div class="post-meta" id="post-889"><div class="post-info"><h1>VB OPC klijent</h1><div class="post-date-single"> Posted By <a href="../author/quercus/index.html" title="Posts by quercus" rel="author">quercus</a> On Monday, October 1, 2012 08:06 PM. Under&nbsp;<a href="../category/automatizacija/index.html" rel="category tag">Automatizacija</a>&nbsp;&nbsp;</div></div><div class="social"><div class="addthis_toolbox addthis_default_style" addthis:url="http://www.quercus-lab.com/vb-opc-klijent/" addthis:title="VB OPC klijent" addthis:description="&nbsp; Prva računala za kontrolu industrijskih procesa praktički i nisu imala nikakvu interakciju sa ljudima koji su nadzirali proizvodnju. Ako su ..."> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_delicious"></a> <a class="addthis_button_digg"></a> <a class="addthis_button_stumbleupon"></a> <a class="addthis_button_reddit"></a> <a class="addthis_button_email"></a> <a class="addthis_button_compact"></a></div></div><div class="post-content-single"><p>&nbsp;</p><p style="text-align: left;"><a href="../wp-content/uploads/2012/06/VB_klijent.png"><img src="../wp-content/uploads/2012/06/VB_klijent.png" alt="" title="VB_klijent" class="size-full wp-image-892 alignleft" height="130" width="180" /></a>Prva računala za kontrolu industrijskih procesa praktički i nisu imala nikakvu interakciju sa ljudima koji su nadzirali proizvodnju. Ako su i imali to su bile kontrolne ploče naslijeđene od ranijih relejnih sustava upravljanja. Razvojem informatičke  tehnologije monitori su postali sastavni dio i industrijskih postrojenja  te je nadzor i interakcija ljudi i strojeva postala mnogo jednostavnija i efikasnija. Razvoj aplikacija u ovom segmentu automatizacijskih sustava dugo je bio moguć  samo sa specijalnim razvojnim alatima. Pojavom OPC tehnologije stvari su se bitno promjenile te se sada ovaj dio posla  može obaviti s gotovo bilo kojim programom i razvojnim okolinom opće (programske) namjene.  Ovdje ću pokušati objasniti razvoj malog programa pisanog u Visual Basicu 6 koji koristi OPC tehnologiju za komunikaciju s procesnim računalom i može poslužiti kao operatorsko sučelje (<a href="http://en.wikipedia.org/wiki/Human-machine_interface"><em>HMI</em></a>).</p><h4 style="text-align: left;">Visual Basic 6</h4><p>Basic (<a href="http://en.wikipedia.org/wiki/BASIC"><span style="font-size: x-small;" size="2"></span><em>Beginners All-Purpose Symbolic Instruction Code</em></a>) je programski jezik kojeg koriste, ili su koristili, najviše programera u povijesti računalstva. Visual Basic 6 je inaćica koja sadrži više stotina naredbi i funkcija te je integriran u razvojnu okolinu  (<em>IDE</em>) za brzi i pregledni razvoj aplikacija s grafičkim sučeljem. Osim  Visual Studija, Visual Basic 6 je sastavni dio i <em>Microsoft Office</em> paketa  gdje služi za automatizaciju Excela, Worda ili PowerPointa. Upravo ta inaćica nazvana VBA (<a href="http://en.wikipedia.org/wiki/Visual_Basic_for_Applications"><em>Visual Basic for Application</em></a>) je i skriptni jezik mnogih komercijalnih razvojnih okolina za razvoj SCADA i HMI aplikacija kao što su <em>WinCC</em>  (<em>Simatic</em>)   ili <em>FactoryTalk</em>  (<em>RockwelSoftware</em>). Ova činjenica te relativna jednostavnost učenja i primjene dobar su razlog da se pozabavite Visual Basicom  mada će vas mnogi profesionalni programeri gledati s prezirom. Iako ne možemo reći u potpunosti, VB6  je objektni programski jezik i za razvoj aplikacije koristimo objekte . Objektima možemo podešavati svojsta (<em>Properties</em>) i definirati akcije na  pojedine događaje (<em>Event</em>s). Isto tako objektima možemo definirati aktivnosti koje će izvršati i to se zovu metode (<em>Methode</em>). Razvojna okolina VB6 sastoji se od nekolko cijelina :</p><ul><li>u sredini zaslona je objekt koji se naziva forma<em> (Form</em>) i on predstavlja grafičko sučelje naše aplikacije. Na formu stavljamo ostale objekte grafičkog sučelja kao što su tipke (<em>Buttons</em>), natpisi (<em>Labels</em>), padajuči izbornici (<em>DropdownBoxs</em>), slike (<em>Images</em>) i tako dalje.  Isto tako u na tome mjestu može biti programski editor gdje pišemo programski kod. Klikom miša na pojedini objekt prelazimo iz grafičkog u tekstalni mod izrade aplikacije odnosno prelazimo u programski editor.</li><li>s lijeve strane zaslona  nalazi se traka s dostupnim objetima (<em>Toolbox</em>) koje možemo prebaciti na formu  jednostavnim potezanjem  mišom.</li><li>s desne strane uobićajeno je da se nalaze tablični preglednici svojstava i strukture našeg projekta. Kada kliknemo na pojedini objekt na  formu (selektiramo ga) u ovom pregledniku se automatski izlistavaju svojstva dotičnog objeka gdje ta  svojstva možemo i mijenjati.</li></ul><p style="text-align: center;"><a href="../wp-content/uploads/2012/07/VB6_IDE.png"><img src="../wp-content/uploads/2012/07/VB6_IDE.png" title="VB6_IDE" class="aligncenter size-full wp-image-921" height="400" width="640" /></a></p><p>Osim toga na vrhu zaslona nalazi se standarni izbornik (<em>Menu</em>) sa svim alatima potrebnim za manipulaciju s programskim elementima, kompaliranjem programa, traženjem pogrešaka i definiranjem opcija razvojne okoline. Na dnu zaslona se u pojedinim fazama  programiranja pojavljuju prozori s rezultatima kompajliranja i eventualnim pogreškama. Dakle ako niste nikada programirali u VB6 potrebno je malo detaljinije se upoznati s načinom  rada u njemu. Na interentu imate mnogo <a href="http://www.ic.ims.hr/vba/vba-kazalo.html">tutorijala</a> od početnih koraka do naprednih opcija pa se ja ovdje neću više baviti time.</p><h4>OPC server &#8211; simulator procesa</h4><p>Da bi zrada bilo koje HMI/SCADA aplikacije bila komforna, odnosno da se ne piše na slijepo, potrebno je imati i vezu prema sklopovskoj opremi (PLC-u). Kako je kanal komunikacije  prilkom pisanja ovakvih aplikacija korištenjem VB6  OPC server neophodno je imati i OPC server sposoban za komunikaciju prema ciljanom PLC-u. Da bi  vam demonstrirali primjer pisanja male HMI aplikcaije koje  vi možete modificirati i testirati napisan je poseban OPC server. Ovaj OPC server ne treba nikakvu slopovsku opremu nego u svom kodu mijenja vrijednosti tag varijabli. Ovakve simulatorske OPC server možete naći kod svih proizvođača OPC servera ali ono što ovaj server razlikuje od njih je to da on u potpunosti simulira mali stvarni proces. To znaći da vi ne morate ručno mijenjati vrijednosti OPC tagova (na strani simulatora) nego se OPC server ponaša kao da je spojen na PLC koji upravlja industrijskim procesom. Radi se o jednostavnom procesu punjenja i pražnjenja spremnika tekućine.</p><p>OPC server QuercusLab.ProcesSimulatorLite.1.0 sadrži sljedće OPC stavke:</p><table border="1"><tbody><tr><td style="text-align: center;"><strong>OPC stavka</strong></td><td style="text-align: center;"><strong>Tip varijable</strong></td><td style="text-align: center;"><strong>Opis</strong></td></tr><tr><td> Tank.AutomaticMode</td><td> VT_Bool (Boolean)</td><td> Mod rada simulatora procesa (ručno/automatski)</td></tr><tr><td> Tank.Level.Value</td><td> VT_I4 (Long Integer)</td><td> Trenutna razina tekućine u spremniku</td></tr><tr><td> Tank.Level.Preset</td><td> VT_I4 (Long Integer)</td><td> Zadana razina tekućine u spremniku</td></tr><tr><td> Tank.Level.Hysteresis</td><td> VT_R4 (FLoat)</td><td> Histereza uključivanja punjenja u postocima</td></tr><tr><td> Tank.SourcePump.ON</td><td> VT_Bool (Boolean)</td><td> Status dobavne pumpe</td></tr><tr><td> Tank.DrainValve.ON</td><td> VT_Bool (Boolean)</td><td> Status ventila za ispuštanje</td></tr></tbody></table><p>Punjenje spremnika ostvaruje se uključivanjem dobavne pumpe  <em>Tank.SourcePump.ON</em>  a pražnjenje uključivanjem ventila za ispuštanje <em>Tank.DrainValve.ON</em>. Razina u spremniku <em>Tank.Level.Value</em> se može kontrolirati  definiranjem stavke <em>Tank.AutomaticMode</em>. Ručni mod omogućava neovisnu kontrolu rada dobavne pumpe i ispusnog ventila. Automatski mod osigurava konstantnu zadanu razinu  <em>Tank.Level.Preset</em>  upravljanjem  radom dobavne pumpe. Dobavna pumpa se uključuje nakon što razina padne ispod zadane za vrijednost definiranog postotka <em>Tank.Level.Hystersis</em> a isključuje kada razina dostigne zadanu vrijednost. Mod rada nema utjecaja na ventil za ispuštanje i on se uvijek može uključivati i isključivati.</p><h4>Visual Baisc 6 HMI aplikacija</h4><p>Izgradnja OPC klijent HMI aplikacije korištenjem VB6 programskog jezika  se može razvrstati na dva osnovna načina:</p><ul><li>pisanje programa korištenjem  osnovnih univerzalnih objekta korisničkog sučelja</li><li>pisanje programa korištenjem specijaliziranih objekta namijenjenih radu sa OPC serverom</li></ul><p>Prvi način zahtjeva više posla jer je potrebno pisanje vlastitih rutina dohvata podataka s OPC servera korištenjem poziva specificiranim u DA Automatizacijskom sučelju. Brigu o dobivenim podacima također mora voditi programer te ih obrađivati i prosljeđivati univerzalnim objektima korisničkog sučelja ili baze podataka. Ovakav način uz svoje nedostatke ima i prednosti u vidu potpune kontrole nad aplikacijom i maksimalne prilagodljivosti klijent aplikacije zahtjevima korisnika. Drugi način oslobađa programera ovih poslova jer se o tome brinu odabrani specijalizirani objekti.  Zadatak programera je da odabere objekte koji će najbolje odgovarati zahtjevima OPC klijent aplikacije, implementira  ih u svoj projekt te ih parametrira. Današnja ponuda takvih objekata je dosta velika i ona uključuje kontrole vizualizacije procesa, obrade i prezentacije alarma, pripreme i implementacije recepata, generiranja izvještaja te kontrole baza podataka. Osnovna prednost ovakvog načina izgradnje OPC klijent aplikacije je brzina izrade i smanjena mogućnost skrivenih grešaka jer su korištene kontrole već prošle testiranje. Negativni aspekti su uniformnost aplikacija i dodatna sredstva za nabavku kontrola koja poskupljuju aplikaciju. Naravno da je moguće i kombinacija ova dva načina tako da se maksimalno iskoriste prednosti i eliminiraju  mane obiju načina</p><h4>Grafičko sučelje &#8211; HMI vizualizacija</h4><p>U ovoj OPC klijent HMI aplikaciji pokazati ćemo upravo taj kombinirani način. Aplikacija će se bazirati isključivo na vizualizaciji procesa i upravljanju osnovnim aktuatorima procesa radi jednostavnosti i boljeg razumijevanja početnicima. Shodno tome i elementi za njenu izgradnju su zaparavo grafički objekti vizualizacije. Kao primjer korištenja gotovih  objekta,koji mogu biti komercijalni ili besplatni,  imat ćemo jednostavne grafičke prekidače i lampice. Ovi objekti su zapravo ActiveX kontrole koje smo razvili isto tako korištenjem Visual Basica te su kompajlirani zasebno.  <a href="http://en.wikipedia.org/wiki/ActiveX">ActiveX</a>  objekt koje ćemo koristi nosi naziv <em>Mini_HMI.ocx</em> i sadrži kontrole <em>qlSwitc</em>h, <em>qlLam</em>p i<em> qlSwitchFaceplate</em>.</p><p style="text-align: left;"><a href="../wp-content/uploads/2012/07/Mini_HMI_ActiveX.png"><img src="../wp-content/uploads/2012/07/Mini_HMI_ActiveX.png" title="Mini_HMI_ActiveX" class="aligncenter size-full wp-image-927" height="158" width="382" /></a></p><p style="text-align: left;">Drugi način je kreiranje vlastiti kontrola unutar samog programskog koda koji se koriste isto kao i prije opisane komercijalne kontrole. Generiranje ovih kontrola je na način da se u projekt doda takozvani <em>UserControl</em> objekt. <em>UserControl</em> može sadržavati sve što i <em>Form</em> objekt tako da se više standardnih VB kontrola može implementirati u novu, vlastitu. Ponašanje ovakvog objekta unutar HMI aplikacije definirate u programskom kodu.  Programski kod korisničkih kontrola je,  kao i izvršni kod, integralni dio Visual Basic projekta. Programiranje ovih kontrola je , uz neke specifičnosti, identično kao i programiranje ostalih elementa VB6 projekta. Važno je napomenuti da se prilkom kreiranja  UserControl objekta vodi idejom da se on piše što je više moguće  univerzalno da bi se mogao upotrebiti više puta  unutar samog projekta ili na nekim drugim projektima. Dobro napisani UserControl se može izdvojiti iz projekta i iz njega se može kompajlirati ActiveX kontrola koju smo spomenuli prije.  U našoj HMI aplikaciji koristit ćemo UserControl objekt <em>qlTank</em> koji će vizualizirat sam spremnik. Korisnička kontrola se sastoji od dvije  <em>Label</em> kontrole te jedne <em>Shape</em> kontrole. Label kontrole služe za ispis naziva spremnika i ispisa razine tekućine u spremniku dok Shape kontrola predstavlja senzor razine. Sama dinamička vizualizacija razine u spremniku odrađena je korištenjem grafičkih API poziva. Ovaj način programiranja je malo složeniji i zahtjeva  bolje poznavanje programiranja ali omogućava efektivniju i složeniju vizualizaciju. Ako niste vični ovakvom načinu programiranja na raspolaganju su vam milijuni besplatnih <em>UserControl</em> objekta koje možete skinuti s interneta i koristiti prilikom razvoja  vlastite HMI aplikacije.</p><p style="text-align: left;"><a href="../wp-content/uploads/2012/07/UserControl_qlTank.png"><img src="../wp-content/uploads/2012/07/UserControl_qlTank.png" title="UserControl_qlTank" class="aligncenter size-full wp-image-929" height="476" width="640" /></a></p><p style="text-align: left;">Treći način je da ne koristite ništa od ovoga navedenog nego da svoju HMI aplikaciju gradite korištenjem standardnih kontrola koje dolaze uz VisualBasic 6 i pisanjem programskog koda u osnovnim procedurama.</p><p style="text-align: left;">Kreiranje grafičkog sučelja odnosno vizualizacije započinjete postavljanjem gore navedenih objekta na glavnu (u ovom slučaju i jedinu) formu aplikacije. Prilikom pokretanja VB6 automatski se generiranja jedan <em>Form</em> objekt koji je ujedno i glavni odnosno startni. Po potrebi možete dodavati još formi korištenjem menu komandi <em>Project.AddForm</em> te ih pozivati iz programskog koda u skladu s vašim idejama. Elemente  korisničkog sučelja jednostavno dovlačite iz trake s alatima i postavljate na formu. Prilikom postavljanja automatski se generiraju imena objekta i oni se pojavljuju u tablici na desnoj strani ekrana. Tamo im možete mijenjati nazive kao i većinu svojstava. U traci s alatima se nakon prvog pokretanja mogu naći samo standardne kontrole. U našem slučaju se koristimo s dodatnim kontrolama te ih moramo dodati u traku s alatima. ActiveX kontrole su datoteke s ekstenzijom <em>*.ocx</em> i uobičajno je da se nalaze u sistemskom folderu &#8230;<em>windows/system32  </em>ali će raditi s bilo koje lokacije ako se dobro registriraju. Dakle  nakon što ste kopirali ActiveX datoteku u željeni direktorij potrebno je kontrolu registrirati i to činite tako da odete na  <em>Windows StartButon/Run</em> te u Open upišete  <em>&#8220;regsrv32 &lt;puna putanja/naziv activex datoteke&gt;&#8221;</em>.  Nakon što ste uspješno registrirali ActiveX kontrolu možete ju dodati u traku s alatima tako što će te kliknuti (desni klik)  na traku s alatima i izbrati komandu <em>Components</em>. Na zaslonu će se pojaviti lista svih regsitriranih ActiveX kontrola te će te ju odabrati i kliknuti OK. U našem slučaju će te odabrati &#8220;Quercus Lab mini HMI Components&#8221; i nakon što ste kliknuli Ok gore opisane kontrole odnosno njihove ikone će se pojaviti u traci s alatima.</p><p style="text-align: left;"><a href="../wp-content/uploads/2012/07/RegOcx.png"><img src="../wp-content/uploads/2012/07/RegOcx.png" title="RegOcx" class="aligncenter size-full wp-image-931" height="332" width="470" /></a></p><p style="text-align: left;">UserControl  ikone se automatski pojavljuju u traci s alatima kada se dodaju u projekt. Dodati se mogu na dva načina. Prvi je da se iz menija aktivira komanda <em>Project/Add UserControl</em> i tada se dodaje korisnička kontrola bez koda. Dakle ovo će te raditi kada želite napraviti novu korisničku kontrolu. U slučaju da ju već imate, bilo iz prijašnjeg projekta ili ste ju skinuli s interneta, dodat će te ju na način da kliknete na <em>Project</em> drvo ( na desnoj strani zaslona) te aktivirate komandu <em>Add/User Control</em> te iz dijaloga <em>Add UserControl/Existing</em> izaberete  datoteku s programskim kodom kontrole.</p><p style="text-align: center;"><a href="../wp-content/uploads/2012/07/Add_UserControl.png"><img src="../wp-content/uploads/2012/07/Add_UserControl.png" title="Add_UserControl" class="aligncenter size-full wp-image-945" height="328" width="604" /></a></p><h4 style="text-align: left;">Spajanja na OPC server</h4><p>Nakon što ste pripremili i kreirali svoje HMI grafičko sučelje možete priječi na pisanje koda za komunikaciju s procesnom opremom. Ovdje se pristup bitno razlikuje od rada na komercijalnim SCADA razvojnim alatima. Ako je kreiranje izgleda grafičkog sučelje bilo slično komunikacijski dio je morate odraditi isključivo pisanjem programskog koda. Još je nešto neophodno da napravite prije samog kodiranja a to je podešavanje komunikacijskog kanala. U VB 6 on može biti isključivo OPC server i moramo u projekt dodati ActivX objekt koji zna komunicirati s njim. Taj objekt se naziva <em> DA Automation Wraper</em>  i može se besplatno skinuti s web stranica OPC fondacije. Kao i kontrole i ovaj wraper se mora prvo registrirati u sustav po gore opisanoj proceduri a tek potom ga se može  dodati u reference projekta. Dodavanje se vrši izborom komande <em>Project/References</em> iz glavnog menija.</p><p style="text-align: left;"><a href="../wp-content/uploads/2012/07/Reg_DAWraper.png"><img src="../wp-content/uploads/2012/07/Reg_DAWraper.png" title="Reg_DAWraper" class="aligncenter size-full wp-image-937" height="310" width="469" /></a></p><p style="text-align: left;">Sada smo spremni za pisanje koda: Pisanje koda započinjemo u području deklaracija tako da deklariramo neophodne OPC objekte. Radi se o objektima tipa <i>OPCServer</i>, <i>OPCGroups</i> i <i>OPCGroup</i>. Objekte koji imaju događaje deklarirat ćemo s  ključnom riječju <i>WithEvents</i>  da bi mogli koristiti iste. Drugi dio deklaracija odnosi se na varijable u koje spremamo podatke. To će biti varijable tipa polje u koje ćemo spremati nazive tagova (<i>OPCItemIDs</i>), korisničke šifre tagova (<i>OPCItemsClientHandles</i>), serverske šifre (<i>ItemServerHandles</i>) te greške prilikom transakcija s OPC serverom (<i>ItemServerErrors</i>). Na kraju dodajemo ostale varijable koje će služiti u algoritmima prezentacije podataka.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #151B8D; font-weight: bold;">Dim</span> <span style="color: #8D38C9; font-weight: bold;">WithEvents</span> simOPCServer  <span style="color: #151B8D; font-weight: bold;">As</span> OPCServer
<span style="color: #151B8D; font-weight: bold;">Dim</span> simGroups <span style="color: #151B8D; font-weight: bold;">As</span> OPCGroups
<span style="color: #151B8D; font-weight: bold;">Dim</span> <span style="color: #8D38C9; font-weight: bold;">WithEvents</span> simOPCGroup <span style="color: #151B8D; font-weight: bold;">As</span> OPCGroup
<span style="color: #151B8D; font-weight: bold;">Dim</span> OPCItemCollection <span style="color: #151B8D; font-weight: bold;">As</span> OPCItems
&nbsp;
<span style="color: #151B8D; font-weight: bold;">Dim</span> OPCItemCount <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Integer</span>                         <span style="color: #008000;">' količina opc stavki
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> OPCItemIDs() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">String</span>                          <span style="color: #008000;">' polje identifikacijskih oznaka (naziva) stavki
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> OPCItemsClientHandles() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>                 <span style="color: #008000;">' polje šifri stavki definiranih od strane klijenta
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> ItemServerHandles() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>                     <span style="color: #008000;">' polje šifri stavki definiranih od strane servera
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> ItemServerErrors() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>                      <span style="color: #008000;">' polje za spremanje greški servera
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> RemoveItemServerErrors() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>                <span style="color: #008000;">'
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> WriteServerHandles() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>                    <span style="color: #008000;">' polje za upis stavki na opc server - serverska sifra
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> ItemsValue() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Variant</span>                         ' polje za vrijednosti stavki</pre></td></tr></table></div><p>Nakon što smo deklarirali neophodne varijable OPC objekte potrebno je na početku izvršavanja programa i kreirati ih. To  ćemo  napraviti u događaju <em>Form _Load</em>:</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #E56717; font-weight: bold;">Private</span> <span style="color: #E56717; font-weight: bold;">Sub</span> Form_Load()
<span style="color: #008000;">' EVENT: kada se ucita form (prakticki na pocetku programa)
</span>
<span style="color: #151B8D; font-weight: bold;">Set</span> simOPCServer = <span style="color: #E56717; font-weight: bold;">New</span> OPCServer                                <span style="color: #008000;">' kreira se objekt OPCServer
</span><span style="color: #E56717; font-weight: bold;">Call</span> OPC_Connect(<span style="color: #800000;">&quot;QuercusLab.ProcesSimulatorLite.1.0&quot;</span>)          <span style="color: #008000;">' poziv potprograma spajanja na OPC server
</span><span style="color: #E56717; font-weight: bold;">Call</span> OPCValue_Init                                              <span style="color: #008000;">' poziv potprograma inicijalizacije vrijednosti procesa
</span>
<span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #E56717; font-weight: bold;">Sub</span></pre></td></tr></table></div><p>Za spajanje i prekid veze s OPC serverom pisat ćemo posebne procedure i onda ih pozivati po potrebi. Procedura za spajanje naziva se OPC_Connect a kao parametar prosljeđujemo naziv OPC servera.  Pozivom metode <em>simOPCServer</em><em>.Connect</em> spajamo se na isti. Slijedi kreiranje OPCGruop objekta te definiranje njegovih svojstava. Neophodno je kreirati bar jednu OPC grupu metodom <em> simGroups .Add(&#8220;Tank&#8221;)</em> te definirati vrijeme osvježavanja podataka svojstvom <em>simGroups.UpdateRate.</em>  Potom ćemo proglasiti grupu aktivnom s svojstvom <em>simGroups.DefaultGroupIsActive = True</em>. Želimo li zaprimati podatke svaki puta kada se promjene vrijednosti tagova definirati ćemo to svojstvom <em>simGroups.IsSubscribed = True</em>. Dodavanje tagova (u OPC terminologiji <em>Items</em>&#8211; stavki) započinjemo dimenzioniranjem polja u koja spremamo simboličke nazive i korisničke  šifre tagova.  Nazive spremamo u u polje <i>OPCItemIDs</i> a korisničke šifre u polje <i>OPCItemClientHandles</i>. Završetak dodavanje tagova je pozivanje metode<i> OPCItemCollection.OPCItems.AddItems</i>  a parametri koji su neophodni su broj stavki (broj članova definiranih polja), polje s nazivima stavki (<i>OPCItemsIDs</i>), polje s korisničkim šiframa (<em>OPCItem</em><i>ClientHandles)</i>, polje serverskih šifri (<i>ItemServerHandles)</i> te polje za eventualne greške prilikom transakcije (<i>ItemsServerErrors</i>). Polje serverski šifre je prazno polje koje dimenzionira server i u njega upisuje vlastite šifre naših tagova koje korespondiraju indeksom s korisničkim šiframa.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #E56717; font-weight: bold;">Private</span> <span style="color: #E56717; font-weight: bold;">Sub</span> OPC_Connect(<span style="color: #151B8D; font-weight: bold;">ByVal</span> OPC_ServerName <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">String</span>)
<span style="color: #008000;">' PODPROGRAM: SPAJANJE NA OPC SERVER
</span><span style="color: #008000;">' aktiviram OPCserver objekt , spajam se na njega i dodajem (prijavljujem) tagove
</span>
simOPCServer.Connect (OPC_ServerName)                   <span style="color: #008000;">' spajanje na OPC server
</span>
<span style="color: #151B8D; font-weight: bold;">Set</span> simGroups = simOPCServer.OPCGroups                  <span style="color: #008000;">' kreira se objekt OPCGroups
</span>simGroups.DefaultGroupIsActive = <span style="color: #00C2FF; font-weight: bold;">True</span>                   <span style="color: #008000;">' objekt aktivan
</span>simGroups.DefaultGroupDeadband = 0                      <span style="color: #008000;">' definicija &quot;mrtvog pojasa&quot; analognih stavki (globalno)
</span>
<span style="color: #151B8D; font-weight: bold;">Set</span> simOPCGroup = simGroups.Add(<span style="color: #800000;">&quot;Tank&quot;</span>)                 <span style="color: #008000;">' kreira se objekt OPCGroup s nazivom &quot;Tank&quot;
</span>simOPCGroup.UpdateRate = 300   <span style="color: #008000;">' milisekunda            ' period osvježavanja podataka  u milisekundama
</span>simOPCGroup.DeadBand = 0                                <span style="color: #008000;">' definicija &quot;mrtvog pojasa&quot; analognih stavki
</span>simOPCGroup.IsSubscribed = <span style="color: #00C2FF; font-weight: bold;">True</span>                         <span style="color: #008000;">' pretplate stavki aktivne
</span>
<span style="color: #151B8D; font-weight: bold;">Set</span> OPCItemCollection = simOPCGroup.OPCItems            <span style="color: #008000;">' kreira se objekt OPCItems
</span>OPCItemCollection.DefaultIsActive = <span style="color: #00C2FF; font-weight: bold;">True</span>                <span style="color: #008000;">' objekt aktivan
</span>
<span style="color: #008000;">' priprema  polja stavki za dodavanje na OPC server
</span>OPCItemCount = 6                                        <span style="color: #008000;">' broj stavki
</span><span style="color: #151B8D; font-weight: bold;">ReDim</span> OPCItemIDs(6)                                     <span style="color: #008000;">' dimenzioniranje polja naziva stavki
</span><span style="color: #151B8D; font-weight: bold;">ReDim</span> OPCItemsClientHandles(6)                          <span style="color: #008000;">' dimenzioniranje polja šifri stavki
</span><span style="color: #008000;">' definiranje stavki
</span>OPCItemsClientHandles(1) = 1: OPCItemIDs(1) = <span style="color: #800000;">&quot;Tank.Level.Value&quot;</span>         <span style="color: #008000;">'
</span>OPCItemsClientHandles(2) = 2: OPCItemIDs(2) = <span style="color: #800000;">&quot;Tank.Level.Preset&quot;</span>
OPCItemsClientHandles(3) = 3: OPCItemIDs(3) = <span style="color: #800000;">&quot;Tank.Level.Hysteresis&quot;</span>
OPCItemsClientHandles(4) = 4: OPCItemIDs(4) = <span style="color: #800000;">&quot;Tank.SourcePump.ON&quot;</span>
OPCItemsClientHandles(5) = 5: OPCItemIDs(5) = <span style="color: #800000;">&quot;Tank.DrainValve.ON&quot;</span>
OPCItemsClientHandles(6) = 6: OPCItemIDs(6) = <span style="color: #800000;">&quot;Tank.AutomaticMode&quot;</span>
&nbsp;
<span style="color: #008000;">' dodavanje stavki na server
</span><span style="color: #008000;">' OPCItemCount - broj stavki  koje se  dodaju
</span><span style="color: #008000;">' ItemsIDs - polje s nazivima tagova
</span><span style="color: #008000;">' OPCItemsClientHandles - polje s siframa stavki definirani od strane klijenta
</span><span style="color: #008000;">' ItemServerHandles - polje u koje ce OPC server upisati (vratiti) serverske sifre stavki
</span><span style="color: #008000;">' (ove sifre ce se koristiti prilikom upisa vrijednosti tagova na OPC server)
</span><span style="color: #008000;">' ItemServerErrors - polje u koje ce server upisati eventualne greske prilkom ove transakcije
</span>OPCItemCollection.AddItems OPCItemCount, OPCItemIDs, OPCItemsClientHandles, ItemServerHandles, ItemServerErrors
&nbsp;
<span style="color: #008000;">' ako je nesto poslo krivo ispisujem gresku i zaustavlja aplikaciju
</span><span style="color: #8D38C9; font-weight: bold;">For</span> i = <span style="color: #151B8D; font-weight: bold;">LBound</span>(ItemServerErrors) <span style="color: #8D38C9; font-weight: bold;">To</span> <span style="color: #151B8D; font-weight: bold;">UBound</span>(ItemServerErrors)
    <span style="color: #8D38C9; font-weight: bold;">If</span> ItemServerErrors(i) &amp;lt;&amp;gt; 0 <span style="color: #8D38C9; font-weight: bold;">Then</span>
        MsgBox <span style="color: #800000;">&quot;Greška prilkom dodavanja stavki na OPC server!&quot;</span> &amp;amp; OPCItemIDs(i), vbOKOnly, <span style="color: #800000;">&quot;Error&quot;</span>
        Unload Me
        <span style="color: #151B8D; font-weight: bold;">Stop</span>
    <span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #8D38C9; font-weight: bold;">If</span>
<span style="color: #8D38C9; font-weight: bold;">Next</span>
<span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #E56717; font-weight: bold;">Sub</span></pre></td></tr></table></div><h4>Primanje i slanje podataka</h4><p>Zahvaljujući tome što smo se prilikom spajanja pretplatili (<em>.IsSusctibed=True</em>) na podatke ne trebamo provjeravati stanje vrijednosti tagova. OPC server će svaki put kada se vrijednost bilo kojega taga promjeni generirati događaj <em>DataChange</em> i proslijediti nam nove vrijednosti. Prosljeđuje se broj stavki <em>NumItems</em> (praktički broj elementa polja podataka), polje s šiframa stavki <em>ClientHandles</em>, polje s vrijednostima tagova <em>ItemValues</em>, polje s kvalitetom veze <em>Qualities</em>, polje s vremenom očitanja <em>TimeStamps</em> te oznake transakcije <em>TransactionID</em>. Na nama je zadatak  da prođemo kroz polje korisnički šifri, dekodiramo tagove te vrijednosti istih ispišemo u kontrole na našem ekranu. To uobičajno činimo koristeći se <em>Case</em> petljom za dekodiranje i <em>For&#8230;Next</em> petljom za provjeru svih članova polja.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #E56717; font-weight: bold;">Private</span> <span style="color: #E56717; font-weight: bold;">Sub</span> simOPCGroup_DataChange(<span style="color: #151B8D; font-weight: bold;">ByVal</span> TransactionID <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>, <span style="color: #151B8D; font-weight: bold;">ByVal</span> NumItems <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>, ClientHandles() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>, ItemValues() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Variant</span>, Qualities() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>, TimeStamps() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Date</span>)
<span style="color: #008000;">' EVENT: kada se promjeni stanje &quot;pretplacenih&quot; tagova OPC server generira ovaj event i salje vrijednosti tih tagova
</span><span style="color: #008000;">' NumItems - broj (kolicina) tagova
</span><span style="color: #008000;">' ClinetHandles() - korisnicke sifre tagova
</span><span style="color: #008000;">' ItemsValue() - vrijednosti tagova
</span><span style="color: #151B8D; font-weight: bold;">Dim</span> i <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Integer</span>
&nbsp;
<span style="color: #008000;">' obrada svih tagova
</span><span style="color: #8D38C9; font-weight: bold;">For</span> i = 1 <span style="color: #8D38C9; font-weight: bold;">To</span> NumItems
    <span style="color: #008000;">'Debug.Print ClientHandles(i)
</span>    <span style="color: #008000;">'Debug.Print
</span>    <span style="color: #8D38C9; font-weight: bold;">Select</span> <span style="color: #8D38C9; font-weight: bold;">Case</span> ClientHandles(i)
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 1
        Me.tnkMain.Value = ItemValues(i)
        <span style="color: #8D38C9; font-weight: bold;">If</span> Me.tnkMain.Maxlevel = <span style="color: #00C2FF; font-weight: bold;">True</span> <span style="color: #8D38C9; font-weight: bold;">Or</span> Me.tnkMain.MinLevel = <span style="color: #00C2FF; font-weight: bold;">True</span> <span style="color: #8D38C9; font-weight: bold;">Then</span>
            Me.lmpAlarm.Value = <span style="color: #00C2FF; font-weight: bold;">True</span>
            <span style="color: #8D38C9; font-weight: bold;">If</span> Me.tnkMain.Maxlevel = <span style="color: #00C2FF; font-weight: bold;">True</span> <span style="color: #8D38C9; font-weight: bold;">Then</span> Me.labAlarmText.Caption = <span style="color: #800000;">&quot;Razina iznad dozvoljene&quot;</span>
            <span style="color: #8D38C9; font-weight: bold;">If</span> Me.tnkMain.MinLevel = <span style="color: #00C2FF; font-weight: bold;">True</span> <span style="color: #8D38C9; font-weight: bold;">Then</span> Me.labAlarmText.Caption = <span style="color: #800000;">&quot;Razina ispod dozvoljene&quot;</span>
        <span style="color: #8D38C9; font-weight: bold;">Else</span>
            Me.lmpAlarm.Value = <span style="color: #00C2FF; font-weight: bold;">False</span>: Me.labAlarmText.Caption = <span style="color: #800000;">&quot;&quot;</span>
        <span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #8D38C9; font-weight: bold;">If</span>
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 2
        Me.txtlevelPreset.Text = Str(ItemValues(i))
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 3
        Me.txtHystersis.Text = Str(ItemValues(i))
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 4
        Me.lmpSourcePump.Value = ItemValues(i)
        <span style="color: #E56717; font-weight: bold;">Call</span> SourcePipeAnimation(ItemValues(i))
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 5
        Me.lmpDrainValve.Value = ItemValues(i)
        <span style="color: #E56717; font-weight: bold;">Call</span> DrainPipeAnimation(ItemValues(i))
    <span style="color: #8D38C9; font-weight: bold;">Case</span> 6
        Me.swfAutomatic.LampValue = ItemValues(i)
    <span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #8D38C9; font-weight: bold;">Select</span>
<span style="color: #8D38C9; font-weight: bold;">Next</span> i
&nbsp;
<span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #E56717; font-weight: bold;">Sub</span></pre></td></tr></table></div><p>Želimo li promjeniti vrijednost neke stavke na raspolaganju su nam funkcije za sinkroni i asinkroni  upis. Sinkroni upis ćemo napravit funkcijom <em>SyncWrite</em> dok su nam parametri: broj stavki koje upisujemo , polje s serverskim šiframa, polje s vrijednostima stavki i polje za eventualne greške prilikom ove operacije. Ovdje valja primjetiti da se kao parametar koriste serverske a ne korisničke šifre stavki. Serverske šifre su upravo one koje nam je OPC server vratio prilkom dodavanja naši korisničkih šifri. U našem primjeru na početku programa u OPC server zapisujemo inicijalna stanja nekih stavki da bi nam simulator počeo raditi  a to radimo u proceduri <em>OPCValue_Init</em>.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #E56717; font-weight: bold;">Private</span> <span style="color: #E56717; font-weight: bold;">Sub</span> OPCValue_Init()
<span style="color: #008000;">' PODPROGRAM : POCETNE POSTAVKE
</span><span style="color: #008000;">' upisujem u OPC server zadanu vrijednost
</span>
<span style="color: #151B8D; font-weight: bold;">ReDim</span> WriteServerHandles(3): <span style="color: #151B8D; font-weight: bold;">ReDim</span> ItemsValue(3)
WriteServerHandles(1) = ItemServerHandles(2): ItemsValue(1) = 1900                          <span style="color: #008000;">' &quot;Tank.LevelPreset&quot; = 1900
</span>WriteServerHandles(2) = ItemServerHandles(3): ItemsValue(2) = 80                            <span style="color: #008000;">' &quot;Tank.LevelHysteresis&quot; = 80
</span>WriteServerHandles(3) = ItemServerHandles(6): ItemsValue(3) = Me.swfAutomatic.SwitchValue   <span style="color: #008000;">' &quot;Tank.AutomaticMode&quot; = stanje prekidaca MAN-AUTO
</span><span style="color: #008000;">' sinkrono zapisivanje vrijednosti
</span><span style="color: #008000;">' 3 - broj stavki
</span><span style="color: #008000;">' WriteServerHandles - polje s siframa definiranim od servera
</span><span style="color: #008000;">' ItemsValue - polje se definiranim novim vrijednostima
</span><span style="color: #008000;">' ItemServerErrors - polje s greškama prilkom zapisivanja
</span>simOPCGroup.SyncWrite 3, WriteServerHandles, ItemsValue, ItemServerErrors
<span style="color: #008000;">' obrada greske
</span><span style="color: #8D38C9; font-weight: bold;">For</span> i = <span style="color: #151B8D; font-weight: bold;">LBound</span>(ItemServerErrors) <span style="color: #8D38C9; font-weight: bold;">To</span> <span style="color: #151B8D; font-weight: bold;">UBound</span>(ItemServerErrors)
    <span style="color: #8D38C9; font-weight: bold;">If</span> ItemServerErrors(i) &amp;lt;&amp;gt; 0 <span style="color: #8D38C9; font-weight: bold;">Then</span>
        MsgBox <span style="color: #800000;">&quot;Greška prilkom dodavanja stavki na OPC server!&quot;</span>, vbOKOnly, <span style="color: #800000;">&quot;Error&quot;</span>
    <span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #8D38C9; font-weight: bold;">If</span>
<span style="color: #8D38C9; font-weight: bold;">Next</span>
<span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #E56717; font-weight: bold;">Sub</span></pre></td></tr></table></div><p>Na kraju rada  neophodno je da se uredno odjavimo s OPC servera. Ovdje ćemo to ućiniti u događaju Form_Unload. Brisanje stavki  radimo metodom <em>simOPCGroup.OPCItems.Remove</em> a grupe <em>simGroups.Remove</em>. Na kraju oslobodimo memoriju brisanjem objekta koje smo koristili.</p><div class="wp_syntax"><table><tr><td class="code"><pre class="vb" style="font-family:monospace;"><span style="color: #E56717; font-weight: bold;">Private</span> <span style="color: #E56717; font-weight: bold;">Sub</span> Form_Unload(Cancel <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Integer</span>)
<span style="color: #008000;">' EVENT: prije nego se program završi
</span>
<span style="color: #151B8D; font-weight: bold;">Dim</span> RemoveItemServerErrors() <span style="color: #151B8D; font-weight: bold;">As</span> <span style="color: #F660AB; font-weight: bold;">Long</span>
<span style="color: #008000;">' brišemo naše prijavljenje stavke sa servera
</span><span style="color: #008000;">' 6 - broj stavki koje brišemo (sve!)
</span><span style="color: #008000;">' ItemServerHandles - polje serverskih šifri koje brisemo
</span><span style="color: #008000;">' RemoveItemServerErrors - polje s greskama kod brisanja
</span>simOPCGroup.OPCItems.Remove 6, ItemServerHandles, RemoveItemServerErrors
<span style="color: #008000;">' brišemo korištenu grupu
</span><span style="color: #008000;">' brišemo korištene objekte za grupu
</span>simGroups.Remove (<span style="color: #800000;">&quot;Tank&quot;</span>)
<span style="color: #151B8D; font-weight: bold;">Set</span> simOPCGroup = <span style="color: #00C2FF; font-weight: bold;">Nothing</span>
<span style="color: #151B8D; font-weight: bold;">Set</span> simGroups = <span style="color: #00C2FF; font-weight: bold;">Nothing</span>
<span style="color: #008000;">' odspajamo se sa server
</span><span style="color: #008000;">' brišemo objekt za server
</span>simOPCServer.Disconnect
<span style="color: #151B8D; font-weight: bold;">Set</span> simOPCServer = <span style="color: #00C2FF; font-weight: bold;">Nothing</span>
<span style="color: #8D38C9; font-weight: bold;">End</span> <span style="color: #E56717; font-weight: bold;">Sub</span></pre></td></tr></table></div><p>Ovo će biti dovoljno za osnovnu komunikaciju vaše HMI aplikacije i procesnog računala a dalje je na vama da ju nadogradite s željenom, odnosno potrebnom, funkcionalnošću koristeći se standardnim i dodatnim VB6 rutinama.</p><p style="text-align: center;"><a href="../wp-content/uploads/2012/09/VB_OPCClient_Screen1.png"><img src="../wp-content/uploads/2012/09/VB_OPCClient_Screen1.png" title="VB_OPCClient_Screen" class="aligncenter size-full wp-image-1003" height="382" width="640" /></a></p><h4>Preuzimanje</h4><p>Ovdje su opisane samo one programske rutine koje se tiću OPC servera dok  rad sa VB objektima možete vidjeti u programskom kodu. Sve potrebno, uključujući i OPC Srever ProcesSimulatorLite.1.0, da pokušate napraviti vlastiti VB6 OPC klijent ili samo da vidite kako se to radi   možete skinuti ovdje: <a href="../wp-content/uploads/2012/09/vb6clientsetup.html">VB6ClientSetup.exe</a></p><p>Za pokretanje OPC servera ProcesSimulatorLite.1.0 potrebno je imati instaliran NET Framework3.5 kojega možete skinuti sa službenih Microsoftovih stranica: <a href="http://www.microsoft.com/en-us/download/confirmation.aspx?id=21">dotNetFx35setup.exe</a></p><p>Ako nemate instaliran Visual Basic 6 razvojni  paket za pokretanje iskompajliranog primjera bit će vam potreban VB6 Runtime koji možete skinuti ovdje: <a href="http://download.microsoft.com/download/vb60pro/install/6/Win98Me/EN-US/VBRun60.exe">VBRun60.exe</a></p></div><div class="post-tags-single"></div><div class="social"><div class="addthis_toolbox addthis_default_style addthis_32x32_style" addthis:url="http://www.quercus-lab.com/vb-opc-klijent/" addthis:title="VB OPC klijent" addthis:description="&nbsp; Prva računala za kontrolu industrijskih procesa praktički i nisu imala nikakvu interakciju sa ljudima koji su nadzirali proizvodnju. Ako su ..."> <a class="addthis_button_facebook"></a> <a class="addthis_button_twitter"></a> <a class="addthis_button_delicious"></a> <a class="addthis_button_digg"></a> <a class="addthis_button_stumbleupon"></a> <a class="addthis_button_reddit"></a> <a class="addthis_button_email"></a> <a class="addthis_button_compact"></a></div></div></div></div><div class="navigation"><div class="nav-previous"><span class="meta-nav">&larr;</span> <a href="../opc-data-acces-server/index.html" rel="prev">OPC Data Access server</a></div><div class="nav-next"><a href="../netduino-mikrokontroleri-na-objektni-nacin/index.html" rel="next">Netduino &#8211; mikrokontroleri na objektni način</a> <span class="meta-nav">&rarr;</span></div><div class="clearfix"></div></div></div></div><div id="sidebar"><div id="sidebarinner"><ul class="sidebar_list"><li id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://www.quercus-lab.com/"><div> <label class="screen-reader-text" for="s">Search for:</label> <input type="text" value="" name="s" id="s" /> <input type="submit" id="searchsubmit" value="Search" /></div></form></li><li id="recent-posts-2" class="widget widget_recent_entries"><h6>Zadnje objave</h6><ul><li> <a href="../netduino-mikrokontroleri-na-objektni-nacin/index.html">Netduino &#8211; mikrokontroleri na objektni način</a></li><li> <a href="index.html">VB OPC klijent</a></li><li> <a href="../opc-data-acces-server/index.html">OPC Data Access server</a></li><li> <a href="../opc-tehnologija/index.html">OPC tehnologija</a></li><li> <a href="../kapacitivne-dodirne-tipke/index.html">Kapacitivne dodirne tipke</a></li></ul></li><li id="archives-2" class="widget widget_archive"><h6>Arhiva</h6><ul><li><a href='../2013/01/index.html'>January 2013</a></li><li><a href='../2012/10/index.html'>October 2012</a></li><li><a href='../2012/04/index.html'>April 2012</a></li><li><a href='../2012/02/index.html'>February 2012</a></li><li><a href='../2012/01/index.html'>January 2012</a></li><li><a href='../2011/12/index.html'>December 2011</a></li><li><a href='../2011/11/index.html'>November 2011</a></li><li><a href='../2011/10/index.html'>October 2011</a></li></ul></li><li id="categories-2" class="widget widget_categories"><h6>Kategorije</h6><ul><li class="cat-item cat-item-3"><a href="../category/automatizacija/index.html" >Automatizacija</a></li><li class="cat-item cat-item-5"><a href="../category/mikrokontroleri/index.html" >Mikrokontroleri</a></li><li class="cat-item cat-item-6"><a href="../category/razno/index.html" >Razno</a></li></ul></li></ul></div></div><div class="clearfix"></div></div><div id="footer"><div id="footer-right"> Copyright &copy; 2018. All Rights Reserved.</div><div class="clearfix"></div><script type="text/javascript" src="../wp-content/cache/minify/000000/M9FPzs_NTc0r0S1KLcip1MvNzNMx0S8v0E3NTUpNAXEB.js"></script></div></div></div></body><script type="text/javascript">var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-19194791-4']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script>
<!-- Mirrored from www.quercus-lab.com/vb-opc-klijent/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Sep 2018 12:45:16 GMT -->
</html>